---
title: "Preprocessing_ITS"
author: "Yupawadee Galasong"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---
# Load packages
```{r}
pacman::p_load(dada2, tidyverse, phyloseq, patchwork,Biostrings, install = FALSE)
```
# Install an additional package for cutadapt

```{r}
pacman::p_load(devtools, DelayedArray, GenomeInfoDb, ShortRead, install = FALSE)
install_github("omicsCore/SEQprocess")
library("SEQprocess") # Loads the package
#library(help="SEQprocess") # Lists package info
```

# Set up file path
```{r}
path <- "./Data_ITS"
```

# Renaming files
This part will be skipped for now. We only want to see the overall read quality,
sequencing output, and whether the Nakano primers yield lower mitochondria & chloroplast reads
compared to the universal 16S primers.

# Create variables for the forward and reverse reads
```{r}
#Forward read variables
forward_reads <- list.files(path, pattern = "R1", full.names = TRUE)

#Reverse read variables 
reverse_reads <- list.files(path, pattern = "R2", full.names = TRUE)
```

# Create a list of sample names
In Terminal, use ls command to list the file names and pipe the output to a new
txt file called "samples_ITS.txt".
```{r list sample names}
#Remove _R[1,2].fastq.gz extension to obtain true sample names
samples <- list()
filenames <- scan("samples_ITS.txt",character())
for(name in filenames){
  sample <- gsub("_R[0-9].fastq.gz",'',name)
  if(!sample %in% samples){
  samples <- append(samples,sample)
  }
}
#IMPORTANT: sort the 'samples' vector alphabetically so it matches with how R list the files in the path
samples <- sort(unlist(samples))
```

#Create varibales for filtered forward and reverse reads
```{r}
filtered_forward_reads <- file.path(path, "filtered", paste0(samples,"_R1_filtered.fastq.gz"))

filtered_reverse_reads <- file.path(path, "filtered", paste0(samples,"_R2_filtered.fastq.gz"))
```


#Assess Raw Read Quality
The raw read quality for samples #2 and #9 is poor. These are pasteurized orange juice and pasteurized cider, respectively.
```{r Assess Raw Read Quality}
#Display quality plot for forward read samples
forwardQual10_plot <- plotQualityProfile(forward_reads[1:10])
#Total read count 522954
forwardQual20_plot <- plotQualityProfile(forward_reads[11:20])
#Total read count 482898
forwardQual30_plot <- plotQualityProfile(forward_reads[21:30])
#Total read count 378849
forwardQual40_plot <- plotQualityProfile(forward_reads[31:40])
#Total read count 404119
forwardQual50_plot <- plotQualityProfile(forward_reads[41:50])
#Total read count 396690
forwardQual60_plot <- plotQualityProfile(forward_reads[51:60])
#Total read count 469516
forwardQual70_plot <- plotQualityProfile(forward_reads[61:70])
#Total read count 493893
forwardQual80_plot <- plotQualityProfile(forward_reads[71:80])
#Total read count 437201
forwardQual90_plot <- plotQualityProfile(forward_reads[81:90])
#Total read count 435716
forwardQual100_plot <- plotQualityProfile(forward_reads[91:100])
#Total read count 455482
forwardQual110_plot <- plotQualityProfile(forward_reads[101:110])
#Total read count 427092
forwardQual117_plot <- plotQualityProfile(forward_reads[111:117])
#Total read count 211660
#Total count of forward reads generated = 5,116,070

#Display quality plot for  reverse read samples
reverseQual10_plot <- plotQualityProfile(reverse_reads[1:10])
reverseQual20_plot <- plotQualityProfile(reverse_reads[11:20])
reverseQual30_plot <- plotQualityProfile(reverse_reads[21:30])
reverseQual40_plot <- plotQualityProfile(reverse_reads[31:40])
reverseQual50_plot <- plotQualityProfile(reverse_reads[41:50])
reverseQual60_plot <- plotQualityProfile(reverse_reads[51:60])
reverseQual70_plot <- plotQualityProfile(reverse_reads[61:70])
reverseQual80_plot <- plotQualityProfile(reverse_reads[71:80])
reverseQual90_plot <- plotQualityProfile(reverse_reads[81:90])
reverseQual100_plot <- plotQualityProfile(reverse_reads[91:100])
reverseQual110_plot <- plotQualityProfile(reverse_reads[101:110])
reverseQual117_plot <- plotQualityProfile(reverse_reads[111:117])

#Total count of forward reads generated = 5,116,070
#Total count of reads generated = 2 x 5,116,070 = 10,232,140
#Total bp output = 250 bp x 10,232,140 = 2.558 Gbp

```
List of bad quality samples
ITS9 (forward & reverse)
ITS10 (forward & reverse)
ITS11 (forward & reverse)
ITS12 (forward & reverse)
ITS26 (forward & reverse)
ITS27 (forward & reverse)
ITS 29 (reverse)
ITSExtNeg1
ITSExtNeg3
ITSPCRNeg1
ITSPCRNeg2
ITSPCRNeg3